<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Luy·ªán t·∫≠p - H·ªçc Ti·∫øng Ph·∫ßn Lan A1</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Mobile Header -->
    <header class="mobile-header">
        <a href="../index.html" class="logo">üá´üáÆ Suomi A1</a>
        <button class="menu-toggle" id="menuToggle">
            <span></span><span></span><span></span>
        </button>
    </header>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="logo">üá´üáÆ Suomi A1</a>
            <button class="dark-toggle" id="darkToggle">üåô</button>
        </div>
        <ul class="nav-menu">
            <li><a href="../index.html" class="nav-link"><span class="icon">üè†</span> Trang ch·ªß</a></li>
            <li><a href="alphabet.html" class="nav-link"><span class="icon">üî§</span> B·∫£ng ch·ªØ c√°i</a></li>
            <li><a href="pronunciation.html" class="nav-link"><span class="icon">üéØ</span> Ph√°t √¢m</a></li>
            <li><a href="grammar.html" class="nav-link"><span class="icon">üìñ</span> Ng·ªØ ph√°p</a></li>
            <li><a href="verbs.html" class="nav-link"><span class="icon">‚ö°</span> Chia ƒë·ªông t·ª´</a></li>
            <li><a href="vocabulary.html" class="nav-link"><span class="icon">üìö</span> T·ª´ v·ª±ng</a></li>
            <li><a href="phrases.html" class="nav-link"><span class="icon">üí¨</span> M·∫´u c√¢u</a></li>
            <li><a href="practice.html" class="nav-link active"><span class="icon">‚úèÔ∏è</span> Luy·ªán t·∫≠p</a></li>
            <li><a href="roadmap.html" class="nav-link"><span class="icon">üó∫Ô∏è</span> L·ªô tr√¨nh 30 ng√†y</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <section class="page-header">
            <h1>‚úèÔ∏è Luy·ªán t·∫≠p</h1>
            <p>Flashcards, Quiz v√† b√†i t·∫≠p t∆∞∆°ng t√°c</p>
        </section>

        <!-- Practice Mode Selector -->
        <section class="practice-modes">
            <button class="mode-btn active" data-mode="flashcards">
                <span class="mode-icon">üé¥</span>
                <span class="mode-name">Flashcards</span>
            </button>
            <button class="mode-btn" data-mode="quiz">
                <span class="mode-icon">‚ùì</span>
                <span class="mode-name">Quiz</span>
            </button>
            <button class="mode-btn" data-mode="matching">
                <span class="mode-icon">üîó</span>
                <span class="mode-name">N·ªëi t·ª´</span>
            </button>
            <button class="mode-btn" data-mode="typing">
                <span class="mode-icon">‚å®Ô∏è</span>
                <span class="mode-name">ƒêi·ªÅn t·ª´</span>
            </button>
            <button class="mode-btn" data-mode="recording">
                <span class="mode-icon">üéôÔ∏è</span>
                <span class="mode-name">Luy·ªán ph√°t √¢m</span>
            </button>
        </section>

        <!-- FLASHCARDS MODE -->
        <section class="practice-section" id="flashcards-mode">
            <div class="flashcard-settings">
                <label>Ch·ªß ƒë·ªÅ:</label>
                <select id="flashcard-topic">
                    <option value="greetings">Ch√†o h·ªèi</option>
                    <option value="numbers">S·ªë ƒë·∫øm</option>
                    <option value="family">Gia ƒë√¨nh</option>
                    <option value="food">ƒê·ªì ƒÉn</option>
                    <option value="colors">M√†u s·∫Øc</option>
                    <option value="verbs">ƒê·ªông t·ª´</option>
                    <option value="mixed">Tr·ªôn t·∫•t c·∫£</option>
                </select>
            </div>

            <div class="flashcard-container">
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <span class="card-word" id="card-front-text">Hei</span>
                            <button class="card-speak" onclick="event.stopPropagation(); speakCard()">üîä</button>
                        </div>
                        <div class="flashcard-back">
                            <span class="card-word" id="card-back-text">Xin ch√†o</span>
                        </div>
                    </div>
                </div>

                <div class="flashcard-controls">
                    <button class="fc-btn wrong" onclick="markCard('wrong')">‚ùå Ch∆∞a nh·ªõ</button>
                    <button class="fc-btn correct" onclick="markCard('correct')">‚úì ƒê√£ nh·ªõ</button>
                </div>

                <div class="flashcard-progress">
                    <span id="fc-current">1</span> / <span id="fc-total">10</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="fc-progress" style="width: 10%"></div>
                    </div>
                </div>

                <div class="flashcard-stats">
                    <span class="stat correct">‚úì <span id="fc-correct">0</span></span>
                    <span class="stat wrong">‚ùå <span id="fc-wrong">0</span></span>
                </div>
            </div>
        </section>

        <!-- QUIZ MODE -->
        <section class="practice-section hidden" id="quiz-mode">
            <div class="quiz-settings">
                <label>Lo·∫°i c√¢u h·ªèi:</label>
                <select id="quiz-type">
                    <option value="fi-vi">Ph·∫ßn Lan ‚Üí Ti·∫øng Vi·ªát</option>
                    <option value="vi-fi">Ti·∫øng Vi·ªát ‚Üí Ph·∫ßn Lan</option>
                    <option value="audio">Nghe ‚Üí Ch·ªçn ƒë√°p √°n</option>
                </select>
            </div>

            <div class="quiz-container">
                <div class="quiz-question">
                    <span class="q-number">C√¢u <span id="quiz-current">1</span>/<span id="quiz-total">10</span></span>
                    <div class="q-text" id="quiz-question">
                        "Hei" nghƒ©a l√† g√¨?
                    </div>
                    <button class="quiz-speak" id="quiz-speak-btn" onclick="speakQuiz()">üîä Nghe</button>
                </div>

                <div class="quiz-options" id="quiz-options">
                    <button class="quiz-option" onclick="selectAnswer(this, 0)">A. T·∫°m bi·ªát</button>
                    <button class="quiz-option" onclick="selectAnswer(this, 1)">B. Xin ch√†o</button>
                    <button class="quiz-option" onclick="selectAnswer(this, 2)">C. C·∫£m ∆°n</button>
                    <button class="quiz-option" onclick="selectAnswer(this, 3)">D. Xin l·ªói</button>
                </div>

                <div class="quiz-feedback hidden" id="quiz-feedback">
                    <div class="feedback-icon" id="feedback-icon">‚úì</div>
                    <div class="feedback-text" id="feedback-text">Ch√≠nh x√°c!</div>
                </div>

                <button class="quiz-next hidden" id="quiz-next" onclick="nextQuestion()">C√¢u ti·∫øp theo ‚Üí</button>
            </div>

            <div class="quiz-score hidden" id="quiz-score">
                <h3>üéâ K·∫øt qu·∫£</h3>
                <div class="score-circle">
                    <span id="final-score">8</span>/<span id="final-total">10</span>
                </div>
                <p id="score-message">Tuy·ªát v·ªùi! B·∫°n ƒë√£ l√†m r·∫•t t·ªët!</p>
                <button class="btn btn-primary" onclick="restartQuiz()">L√†m l·∫°i</button>
            </div>
        </section>

        <!-- MATCHING MODE -->
        <section class="practice-section hidden" id="matching-mode">
            <div class="matching-info">
                <p>N·ªëi t·ª´ ti·∫øng Ph·∫ßn Lan v·ªõi nghƒ©a ti·∫øng Vi·ªát</p>
                <div class="matching-stats">
                    <span>ƒêi·ªÉm: <span id="match-score">0</span></span>
                    <span>Th·ªùi gian: <span id="match-time">0:00</span></span>
                </div>
            </div>

            <div class="matching-container">
                <div class="matching-column" id="match-finnish">
                    <!-- Finnish words will be inserted here -->
                </div>
                <div class="matching-column" id="match-vietnamese">
                    <!-- Vietnamese words will be inserted here -->
                </div>
            </div>

            <div class="matching-result hidden" id="matching-result">
                <h3>üéâ Ho√†n th√†nh!</h3>
                <p>Th·ªùi gian: <span id="match-final-time">0:00</span></p>
                <button class="btn btn-primary" onclick="restartMatching()">Ch∆°i l·∫°i</button>
            </div>
        </section>

        <!-- TYPING MODE -->
        <section class="practice-section hidden" id="typing-mode">
            <div class="typing-settings">
                <label>H∆∞·ªõng d·ªãch:</label>
                <select id="typing-direction">
                    <option value="vi-fi">Ti·∫øng Vi·ªát ‚Üí Ph·∫ßn Lan</option>
                    <option value="fi-vi">Ph·∫ßn Lan ‚Üí Ti·∫øng Vi·ªát</option>
                </select>
            </div>

            <div class="typing-container">
                <div class="typing-question">
                    <span class="typing-prompt">D·ªãch sang ti·∫øng Ph·∫ßn Lan:</span>
                    <div class="typing-word" id="typing-word">Xin ch√†o</div>
                    <button class="typing-hint-btn" onclick="showHint()">üí° G·ª£i √Ω</button>
                </div>

                <div class="typing-hint hidden" id="typing-hint">
                    <span>G·ª£i √Ω: H _ _</span>
                </div>

                <div class="typing-input-container">
                    <input type="text" id="typing-input" class="typing-input" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." autocomplete="off">
                    <button class="typing-submit" onclick="checkTyping()">Ki·ªÉm tra</button>
                </div>

                <div class="typing-feedback hidden" id="typing-feedback">
                    <div class="typing-result" id="typing-result"></div>
                    <div class="typing-correct-answer" id="typing-correct"></div>
                </div>

                <button class="typing-next hidden" id="typing-next" onclick="nextTyping()">T·ª´ ti·∫øp theo ‚Üí</button>
            </div>

            <div class="typing-progress">
                <span><span id="typing-current">1</span> / <span id="typing-total">10</span></span>
                <div class="progress-bar">
                    <div class="progress-fill" id="typing-progress-bar" style="width: 10%"></div>
                </div>
                <span>ƒê√∫ng: <span id="typing-correct-count">0</span></span>
            </div>
        </section>

        <!-- RECORDING MODE - Luy·ªán ph√°t √¢m -->
        <section class="practice-section hidden" id="recording-mode">
            <div class="recording-info">
                <div class="info-box">
                    <h3>üéôÔ∏è C√°ch s·ª≠ d·ª•ng</h3>
                    <ol>
                        <li>Nh·∫•n <strong>"Nghe m·∫´u"</strong> ƒë·ªÉ nghe ph√°t √¢m chu·∫©n</li>
                        <li>Nh·∫•n <strong>"Ghi √¢m"</strong> v√† ƒë·ªçc theo</li>
                        <li>Nh·∫•n <strong>"Ph√°t l·∫°i"</strong> ƒë·ªÉ nghe gi·ªçng c·ªßa b·∫°n</li>
                        <li>So s√°nh v·ªõi ph√°t √¢m chu·∫©n v√† luy·ªán t·∫≠p l·∫°i!</li>
                    </ol>
                </div>
            </div>

            <div class="recording-settings">
                <label>Ch·ªß ƒë·ªÅ:</label>
                <select id="recording-topic">
                    <option value="greetings">Ch√†o h·ªèi</option>
                    <option value="numbers">S·ªë ƒë·∫øm</option>
                    <option value="family">Gia ƒë√¨nh</option>
                    <option value="food">ƒê·ªì ƒÉn</option>
                    <option value="phrases">M·∫´u c√¢u</option>
                </select>
            </div>

            <div class="recording-card">
                <div class="recording-word">
                    <span class="word-finnish" id="rec-finnish">Hei</span>
                    <span class="word-vietnamese" id="rec-vietnamese">Xin ch√†o</span>
                </div>

                <div class="recording-waveform">
                    <div class="waveform-container" id="waveform-container">
                        <div class="waveform-placeholder">
                            <span>üéµ S√≥ng √¢m s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</span>
                        </div>
                        <canvas id="waveform-canvas" class="hidden"></canvas>
                    </div>
                    <div class="recording-timer hidden" id="recording-timer">
                        <span class="timer-dot"></span>
                        <span id="timer-text">0:00</span>
                    </div>
                </div>

                <div class="recording-controls">
                    <button class="rec-btn sample" onclick="playSample()">
                        <span class="rec-icon">üîä</span>
                        <span>Nghe m·∫´u</span>
                    </button>
                    <button class="rec-btn record" id="record-btn" onclick="toggleRecording()">
                        <span class="rec-icon" id="record-icon">üéôÔ∏è</span>
                        <span id="record-text">Ghi √¢m</span>
                    </button>
                    <button class="rec-btn playback" id="playback-btn" onclick="playRecording()" disabled>
                        <span class="rec-icon">‚ñ∂Ô∏è</span>
                        <span>Ph√°t l·∫°i</span>
                    </button>
                </div>

                <div class="recording-comparison hidden" id="recording-comparison">
                    <h4>üîÑ So s√°nh ph√°t √¢m</h4>
                    <div class="comparison-btns">
                        <button class="compare-btn" onclick="playSample()">
                            <span>üîä Ph√°t √¢m chu·∫©n</span>
                        </button>
                        <button class="compare-btn" onclick="playRecording()">
                            <span>üéß Gi·ªçng c·ªßa b·∫°n</span>
                        </button>
                    </div>
                    <div class="comparison-tip">
                        <p>üí° <strong>M·∫πo:</strong> Ch√∫ √Ω ƒë·ªô d√†i nguy√™n √¢m v√† √¢m ƒëi·ªáu. Ti·∫øng Ph·∫ßn Lan ph√°t √¢m ƒë·ªÅu, kh√¥ng c√≥ thanh ƒëi·ªáu nh∆∞ ti·∫øng Vi·ªát.</p>
                    </div>
                </div>
            </div>

            <div class="recording-nav">
                <button class="nav-arrow prev" onclick="prevRecordingWord()" id="rec-prev">
                    ‚Üê T·ª´ tr∆∞·ªõc
                </button>
                <span class="word-counter">
                    <span id="rec-current">1</span> / <span id="rec-total">10</span>
                </span>
                <button class="nav-arrow next" onclick="nextRecordingWord()" id="rec-next">
                    T·ª´ ti·∫øp ‚Üí
                </button>
            </div>

            <div class="pronunciation-tips">
                <h4>üìö M·∫πo ph√°t √¢m ti·∫øng Ph·∫ßn Lan</h4>
                <div class="tips-grid">
                    <div class="tip-card">
                        <span class="tip-icon">üìè</span>
                        <h5>ƒê·ªô d√†i nguy√™n √¢m</h5>
                        <p>aa, ee, ii... d√†i g·∫•p ƒë√¥i a, e, i. V√≠ d·ª•: "tuli" (l·ª≠a) vs "tuuli" (gi√≥)</p>
                    </div>
                    <div class="tip-card">
                        <span class="tip-icon">üéµ</span>
                        <h5>Kh√¥ng c√≥ thanh ƒëi·ªáu</h5>
                        <p>Ph√°t √¢m ƒë·ªÅu, nh·∫•n nh·∫π √¢m ti·∫øt ƒë·∫ßu. Kh√¥ng l√™n xu·ªëng nh∆∞ ti·∫øng Vi·ªát.</p>
                    </div>
                    <div class="tip-card">
                        <span class="tip-icon">üî§</span>
                        <h5>ƒê·ªçc nh∆∞ vi·∫øt</h5>
                        <p>Ti·∫øng Ph·∫ßn Lan ph√°t √¢m g·∫ßn nh∆∞ 100% theo c√°ch vi·∫øt.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Daily Challenge -->
        <section class="daily-challenge">
            <h2>üèÜ Th·ª≠ th√°ch h√†ng ng√†y</h2>
            <div class="challenge-card">
                <div class="challenge-info">
                    <span class="challenge-date" id="challenge-date">11/12/2025</span>
                    <h4>H·ªçc 5 t·ª´ m·ªõi v·ªÅ Gia ƒë√¨nh</h4>
                    <p>Ho√†n th√†nh flashcard ch·ªß ƒë·ªÅ Gia ƒë√¨nh</p>
                </div>
                <div class="challenge-progress">
                    <div class="challenge-bar">
                        <div class="challenge-fill" id="challenge-fill" style="width: 0%"></div>
                    </div>
                    <span id="challenge-status">0/5 t·ª´</span>
                </div>
                <button class="btn btn-primary" onclick="startChallenge()">B·∫Øt ƒë·∫ßu</button>
            </div>
        </section>

        <!-- Tips -->
        <section class="practice-tips">
            <h3>üí° M·∫πo luy·ªán t·∫≠p hi·ªáu qu·∫£</h3>
            <ul>
                <li><strong>Spaced Repetition:</strong> √în l·∫°i sau 1 ng√†y ‚Üí 3 ng√†y ‚Üí 7 ng√†y ‚Üí 30 ng√†y</li>
                <li><strong>ƒê·ªçc to:</strong> Lu√¥n ƒë·ªçc to khi l√†m flashcard</li>
                <li><strong>Vi·∫øt tay:</strong> K·∫øt h·ª£p vi·∫øt ra gi·∫•y ƒë·ªÉ nh·ªõ l√¢u h∆°n</li>
                <li><strong>Ng·∫Øn nh∆∞ng ƒë·ªÅu:</strong> 15-20 ph√∫t m·ªói ng√†y t·ªët h∆°n 2 gi·ªù m·ªôt tu·∫ßn</li>
            </ul>
        </section>

        <!-- Navigation -->
        <div class="page-nav">
            <a href="phrases.html" class="nav-btn prev">‚Üê M·∫´u c√¢u</a>
            <a href="roadmap.html" class="nav-btn next">L·ªô tr√¨nh 30 ng√†y ‚Üí</a>
        </div>
    </main>

    <!-- Overlay for mobile menu -->
    <div class="overlay" id="overlay"></div>

    <script src="../js/data.js"></script>
    <script src="../js/app.js"></script>
    <script>
        // Practice Data
        const practiceData = {
            greetings: [
                { fi: 'Hei', vi: 'Xin ch√†o' },
                { fi: 'Moi', vi: 'Ch√†o (th√¢n m·∫≠t)' },
                { fi: 'Kiitos', vi: 'C·∫£m ∆°n' },
                { fi: 'Ole hyv√§', vi: 'Kh√¥ng c√≥ g√¨' },
                { fi: 'Anteeksi', vi: 'Xin l·ªói' },
                { fi: 'N√§kemiin', vi: 'T·∫°m bi·ªát' },
                { fi: 'Hyv√§√§ huomenta', vi: 'Ch√†o bu·ªïi s√°ng' },
                { fi: 'Hyv√§√§ p√§iv√§√§', vi: 'Ch√†o bu·ªïi tr∆∞a' },
                { fi: 'Hyv√§√§ iltaa', vi: 'Ch√†o bu·ªïi t·ªëi' },
                { fi: 'Hyv√§√§ y√∂t√§', vi: 'Ch√∫c ng·ªß ngon' }
            ],
            numbers: [
                { fi: 'yksi', vi: 'm·ªôt' },
                { fi: 'kaksi', vi: 'hai' },
                { fi: 'kolme', vi: 'ba' },
                { fi: 'nelj√§', vi: 'b·ªën' },
                { fi: 'viisi', vi: 'nƒÉm' },
                { fi: 'kuusi', vi: 's√°u' },
                { fi: 'seitsem√§n', vi: 'b·∫£y' },
                { fi: 'kahdeksan', vi: 't√°m' },
                { fi: 'yhdeks√§n', vi: 'ch√≠n' },
                { fi: 'kymmenen', vi: 'm∆∞·ªùi' }
            ],
            family: [
                { fi: 'perhe', vi: 'gia ƒë√¨nh' },
                { fi: '√§iti', vi: 'm·∫π' },
                { fi: 'is√§', vi: 'b·ªë' },
                { fi: 'veli', vi: 'anh/em trai' },
                { fi: 'sisko', vi: 'ch·ªã/em g√°i' },
                { fi: 'lapsi', vi: 'con' },
                { fi: 'poika', vi: 'con trai' },
                { fi: 'tytt√∂', vi: 'con g√°i' },
                { fi: 'mummo', vi: 'b√†' },
                { fi: 'pappa', vi: '√¥ng' }
            ],
            food: [
                { fi: 'ruoka', vi: 'ƒë·ªì ƒÉn' },
                { fi: 'leip√§', vi: 'b√°nh m√¨' },
                { fi: 'vesi', vi: 'n∆∞·ªõc' },
                { fi: 'kahvi', vi: 'c√† ph√™' },
                { fi: 'maito', vi: 's·ªØa' },
                { fi: 'liha', vi: 'th·ªãt' },
                { fi: 'kala', vi: 'c√°' },
                { fi: 'peruna', vi: 'khoai t√¢y' },
                { fi: 'omena', vi: 't√°o' },
                { fi: 'juusto', vi: 'ph√¥ mai' }
            ],
            colors: [
                { fi: 'valkoinen', vi: 'tr·∫Øng' },
                { fi: 'musta', vi: 'ƒëen' },
                { fi: 'punainen', vi: 'ƒë·ªè' },
                { fi: 'sininen', vi: 'xanh d∆∞∆°ng' },
                { fi: 'vihre√§', vi: 'xanh l√°' },
                { fi: 'keltainen', vi: 'v√†ng' },
                { fi: 'oranssi', vi: 'cam' },
                { fi: 'ruskea', vi: 'n√¢u' },
                { fi: 'harmaa', vi: 'x√°m' },
                { fi: 'violetti', vi: 't√≠m' }
            ],
            verbs: [
                { fi: 'olla', vi: 'l√†/·ªü' },
                { fi: 'puhua', vi: 'n√≥i' },
                { fi: 'sy√∂d√§', vi: 'ƒÉn' },
                { fi: 'juoda', vi: 'u·ªëng' },
                { fi: 'lukea', vi: 'ƒë·ªçc' },
                { fi: 'kirjoittaa', vi: 'vi·∫øt' },
                { fi: 'menn√§', vi: 'ƒëi' },
                { fi: 'tulla', vi: 'ƒë·∫øn' },
                { fi: 'opiskella', vi: 'h·ªçc' },
                { fi: 'ty√∂skennell√§', vi: 'l√†m vi·ªác' }
            ]
        };

        // Current state
        let currentCards = [];
        let currentIndex = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let isFlipped = false;

        // Mode switching
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const mode = btn.dataset.mode;
                document.querySelectorAll('.practice-section').forEach(s => s.classList.add('hidden'));
                document.getElementById(`${mode}-mode`).classList.remove('hidden');

                // Initialize the mode
                if (mode === 'flashcards') initFlashcards();
                else if (mode === 'quiz') initQuiz();
                else if (mode === 'matching') initMatching();
                else if (mode === 'typing') initTyping();
                else if (mode === 'recording') initRecording();
            });
        });

        // FLASHCARDS
        function initFlashcards() {
            const topic = document.getElementById('flashcard-topic').value;
            if (topic === 'mixed') {
                currentCards = Object.values(practiceData).flat();
            } else {
                currentCards = [...practiceData[topic]];
            }
            shuffleArray(currentCards);
            currentIndex = 0;
            correctCount = 0;
            wrongCount = 0;
            isFlipped = false;
            updateFlashcard();
        }

        function updateFlashcard() {
            if (currentIndex >= currentCards.length) {
                alert(`Ho√†n th√†nh! ƒê√∫ng: ${correctCount}, Sai: ${wrongCount}`);
                initFlashcards();
                return;
            }

            const card = currentCards[currentIndex];
            document.getElementById('card-front-text').textContent = card.fi;
            document.getElementById('card-back-text').textContent = card.vi;
            document.getElementById('fc-current').textContent = currentIndex + 1;
            document.getElementById('fc-total').textContent = currentCards.length;
            document.getElementById('fc-progress').style.width = `${((currentIndex + 1) / currentCards.length) * 100}%`;
            document.getElementById('fc-correct').textContent = correctCount;
            document.getElementById('fc-wrong').textContent = wrongCount;

            // Reset flip state
            document.getElementById('flashcard').classList.remove('flipped');
            isFlipped = false;
        }

        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
            isFlipped = !isFlipped;
        }

        function speakCard() {
            const text = currentCards[currentIndex].fi;
            speak(text);
        }

        function markCard(result) {
            if (result === 'correct') correctCount++;
            else wrongCount++;
            currentIndex++;
            updateFlashcard();
        }

        document.getElementById('flashcard-topic').addEventListener('change', initFlashcards);

        // QUIZ
        let quizQuestions = [];
        let quizIndex = 0;
        let quizScore = 0;
        let quizAnswered = false;

        function initQuiz() {
            const allData = Object.values(practiceData).flat();
            shuffleArray(allData);
            quizQuestions = allData.slice(0, 10);
            quizIndex = 0;
            quizScore = 0;
            quizAnswered = false;

            document.getElementById('quiz-score').classList.add('hidden');
            document.querySelector('.quiz-container').style.display = 'block';
            loadQuizQuestion();
        }

        function loadQuizQuestion() {
            if (quizIndex >= quizQuestions.length) {
                showQuizResult();
                return;
            }

            quizAnswered = false;
            const q = quizQuestions[quizIndex];
            const quizType = document.getElementById('quiz-type').value;

            document.getElementById('quiz-current').textContent = quizIndex + 1;
            document.getElementById('quiz-total').textContent = quizQuestions.length;

            let questionText, correctAnswer, options;

            if (quizType === 'fi-vi' || quizType === 'audio') {
                questionText = quizType === 'audio' ? 'Nghe v√† ch·ªçn nghƒ©a ƒë√∫ng' : `"${q.fi}" nghƒ©a l√† g√¨?`;
                correctAnswer = q.vi;
                document.getElementById('quiz-speak-btn').style.display = quizType === 'audio' ? 'block' : 'none';
                if (quizType === 'audio') speak(q.fi);
            } else {
                questionText = `"${q.vi}" trong ti·∫øng Ph·∫ßn Lan l√† g√¨?`;
                correctAnswer = q.fi;
                document.getElementById('quiz-speak-btn').style.display = 'none';
            }

            document.getElementById('quiz-question').textContent = questionText;

            // Generate options
            const allAnswers = Object.values(practiceData).flat().map(item => quizType === 'vi-fi' ? item.fi : item.vi);
            options = [correctAnswer];
            while (options.length < 4) {
                const rand = allAnswers[Math.floor(Math.random() * allAnswers.length)];
                if (!options.includes(rand)) options.push(rand);
            }
            shuffleArray(options);

            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            const letters = ['A', 'B', 'C', 'D'];
            options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'quiz-option';
                btn.textContent = `${letters[i]}. ${opt}`;
                btn.onclick = () => selectAnswer(btn, opt === correctAnswer);
                btn.dataset.correct = opt === correctAnswer;
                optionsContainer.appendChild(btn);
            });

            document.getElementById('quiz-feedback').classList.add('hidden');
            document.getElementById('quiz-next').classList.add('hidden');
        }

        function selectAnswer(btn, isCorrect) {
            if (quizAnswered) return;
            quizAnswered = true;

            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.disabled = true;
                if (opt.dataset.correct === 'true') {
                    opt.classList.add('correct');
                }
            });

            if (isCorrect) {
                btn.classList.add('correct');
                quizScore++;
                document.getElementById('feedback-icon').textContent = '‚úì';
                document.getElementById('feedback-text').textContent = 'Ch√≠nh x√°c!';
                document.getElementById('quiz-feedback').className = 'quiz-feedback correct';
            } else {
                btn.classList.add('wrong');
                document.getElementById('feedback-icon').textContent = '‚úó';
                document.getElementById('feedback-text').textContent = 'Sai r·ªìi!';
                document.getElementById('quiz-feedback').className = 'quiz-feedback wrong';
            }

            document.getElementById('quiz-feedback').classList.remove('hidden');
            document.getElementById('quiz-next').classList.remove('hidden');
        }

        function nextQuestion() {
            quizIndex++;
            loadQuizQuestion();
        }

        function showQuizResult() {
            document.querySelector('.quiz-container').style.display = 'none';
            document.getElementById('quiz-score').classList.remove('hidden');
            document.getElementById('final-score').textContent = quizScore;
            document.getElementById('final-total').textContent = quizQuestions.length;

            let message = '';
            const percent = (quizScore / quizQuestions.length) * 100;
            if (percent >= 90) message = 'Xu·∫•t s·∫Øc! B·∫°n th·∫≠t gi·ªèi!';
            else if (percent >= 70) message = 'T·ªët l·∫Øm! Ti·∫øp t·ª•c c·ªë g·∫Øng!';
            else if (percent >= 50) message = 'Kh√° ·ªïn! C·∫ßn √¥n luy·ªán th√™m.';
            else message = 'C·ªë g·∫Øng h∆°n nh√©! H√£y √¥n l·∫°i b√†i.';

            document.getElementById('score-message').textContent = message;
        }

        function restartQuiz() {
            initQuiz();
        }

        function speakQuiz() {
            const q = quizQuestions[quizIndex];
            speak(q.fi);
        }

        // MATCHING
        let matchingPairs = [];
        let selectedFi = null;
        let selectedVi = null;
        let matchedCount = 0;
        let matchTimer = null;
        let matchSeconds = 0;

        function initMatching() {
            const allData = Object.values(practiceData).flat();
            shuffleArray(allData);
            matchingPairs = allData.slice(0, 6);
            matchedCount = 0;
            selectedFi = null;
            selectedVi = null;
            matchSeconds = 0;

            document.getElementById('match-score').textContent = '0';
            document.getElementById('match-time').textContent = '0:00';
            document.getElementById('matching-result').classList.add('hidden');

            // Render columns
            const fiColumn = document.getElementById('match-finnish');
            const viColumn = document.getElementById('match-vietnamese');
            fiColumn.innerHTML = '';
            viColumn.innerHTML = '';

            const shuffledFi = [...matchingPairs];
            const shuffledVi = [...matchingPairs];
            shuffleArray(shuffledFi);
            shuffleArray(shuffledVi);

            shuffledFi.forEach((item, i) => {
                const btn = document.createElement('button');
                btn.className = 'match-item fi';
                btn.textContent = item.fi;
                btn.dataset.pair = matchingPairs.indexOf(item);
                btn.onclick = () => selectMatchItem(btn, 'fi');
                fiColumn.appendChild(btn);
            });

            shuffledVi.forEach((item, i) => {
                const btn = document.createElement('button');
                btn.className = 'match-item vi';
                btn.textContent = item.vi;
                btn.dataset.pair = matchingPairs.indexOf(item);
                btn.onclick = () => selectMatchItem(btn, 'vi');
                viColumn.appendChild(btn);
            });

            // Start timer
            if (matchTimer) clearInterval(matchTimer);
            matchTimer = setInterval(() => {
                matchSeconds++;
                const mins = Math.floor(matchSeconds / 60);
                const secs = matchSeconds % 60;
                document.getElementById('match-time').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function selectMatchItem(btn, type) {
            if (btn.classList.contains('matched')) return;

            if (type === 'fi') {
                if (selectedFi) selectedFi.classList.remove('selected');
                selectedFi = btn;
                btn.classList.add('selected');
            } else {
                if (selectedVi) selectedVi.classList.remove('selected');
                selectedVi = btn;
                btn.classList.add('selected');
            }

            // Check if both selected
            if (selectedFi && selectedVi) {
                if (selectedFi.dataset.pair === selectedVi.dataset.pair) {
                    selectedFi.classList.add('matched');
                    selectedVi.classList.add('matched');
                    selectedFi.classList.remove('selected');
                    selectedVi.classList.remove('selected');
                    matchedCount++;
                    document.getElementById('match-score').textContent = matchedCount;

                    if (matchedCount === matchingPairs.length) {
                        clearInterval(matchTimer);
                        document.getElementById('match-final-time').textContent = document.getElementById('match-time').textContent;
                        document.getElementById('matching-result').classList.remove('hidden');
                    }
                } else {
                    selectedFi.classList.add('wrong');
                    selectedVi.classList.add('wrong');
                    setTimeout(() => {
                        selectedFi.classList.remove('wrong', 'selected');
                        selectedVi.classList.remove('wrong', 'selected');
                        selectedFi = null;
                        selectedVi = null;
                    }, 500);
                    return;
                }
                selectedFi = null;
                selectedVi = null;
            }
        }

        function restartMatching() {
            initMatching();
        }

        // TYPING
        let typingData = [];
        let typingIndex = 0;
        let typingCorrect = 0;

        function initTyping() {
            const allData = Object.values(practiceData).flat();
            shuffleArray(allData);
            typingData = allData.slice(0, 10);
            typingIndex = 0;
            typingCorrect = 0;
            loadTypingQuestion();
        }

        function loadTypingQuestion() {
            if (typingIndex >= typingData.length) {
                alert(`Ho√†n th√†nh! ƒê√∫ng: ${typingCorrect}/${typingData.length}`);
                initTyping();
                return;
            }

            const item = typingData[typingIndex];
            const direction = document.getElementById('typing-direction').value;

            if (direction === 'vi-fi') {
                document.querySelector('.typing-prompt').textContent = 'D·ªãch sang ti·∫øng Ph·∫ßn Lan:';
                document.getElementById('typing-word').textContent = item.vi;
            } else {
                document.querySelector('.typing-prompt').textContent = 'D·ªãch sang ti·∫øng Vi·ªát:';
                document.getElementById('typing-word').textContent = item.fi;
            }

            document.getElementById('typing-input').value = '';
            document.getElementById('typing-input').focus();
            document.getElementById('typing-feedback').classList.add('hidden');
            document.getElementById('typing-next').classList.add('hidden');
            document.getElementById('typing-hint').classList.add('hidden');

            document.getElementById('typing-current').textContent = typingIndex + 1;
            document.getElementById('typing-total').textContent = typingData.length;
            document.getElementById('typing-progress-bar').style.width = `${((typingIndex + 1) / typingData.length) * 100}%`;
            document.getElementById('typing-correct-count').textContent = typingCorrect;
        }

        function showHint() {
            const item = typingData[typingIndex];
            const direction = document.getElementById('typing-direction').value;
            const answer = direction === 'vi-fi' ? item.fi : item.vi;

            let hint = answer[0];
            for (let i = 1; i < answer.length; i++) {
                hint += answer[i] === ' ' ? ' ' : ' _';
            }

            document.getElementById('typing-hint').innerHTML = `<span>G·ª£i √Ω: ${hint}</span>`;
            document.getElementById('typing-hint').classList.remove('hidden');
        }

        function checkTyping() {
            const item = typingData[typingIndex];
            const direction = document.getElementById('typing-direction').value;
            const correctAnswer = direction === 'vi-fi' ? item.fi : item.vi;
            const userAnswer = document.getElementById('typing-input').value.trim().toLowerCase();

            const isCorrect = userAnswer === correctAnswer.toLowerCase();

            document.getElementById('typing-feedback').classList.remove('hidden');
            if (isCorrect) {
                typingCorrect++;
                document.getElementById('typing-result').innerHTML = '<span class="correct">‚úì Ch√≠nh x√°c!</span>';
                document.getElementById('typing-correct').textContent = '';
            } else {
                document.getElementById('typing-result').innerHTML = '<span class="wrong">‚úó Ch∆∞a ƒë√∫ng!</span>';
                document.getElementById('typing-correct').textContent = `ƒê√°p √°n: ${correctAnswer}`;
            }

            document.getElementById('typing-next').classList.remove('hidden');
            document.getElementById('typing-correct-count').textContent = typingCorrect;
        }

        function nextTyping() {
            typingIndex++;
            loadTypingQuestion();
        }

        document.getElementById('typing-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkTyping();
        });

        document.getElementById('typing-direction').addEventListener('change', initTyping);

        // ============================
        // RECORDING MODE - Luy·ªán ph√°t √¢m
        // ============================
        const recordingData = {
            greetings: [
                { fi: 'Hei', vi: 'Xin ch√†o' },
                { fi: 'Moi', vi: 'Ch√†o (th√¢n m·∫≠t)' },
                { fi: 'Hyv√§√§ huomenta', vi: 'Ch√†o bu·ªïi s√°ng' },
                { fi: 'Hyv√§√§ p√§iv√§√§', vi: 'Ch√†o bu·ªïi tr∆∞a' },
                { fi: 'Hyv√§√§ iltaa', vi: 'Ch√†o bu·ªïi t·ªëi' },
                { fi: 'N√§kemiin', vi: 'T·∫°m bi·ªát' },
                { fi: 'Kiitos', vi: 'C·∫£m ∆°n' },
                { fi: 'Ole hyv√§', vi: 'Kh√¥ng c√≥ g√¨' },
                { fi: 'Anteeksi', vi: 'Xin l·ªói' },
                { fi: 'Mit√§ kuuluu?', vi: 'B·∫°n kh·ªèe kh√¥ng?' }
            ],
            numbers: [
                { fi: 'yksi', vi: 'm·ªôt' },
                { fi: 'kaksi', vi: 'hai' },
                { fi: 'kolme', vi: 'ba' },
                { fi: 'nelj√§', vi: 'b·ªën' },
                { fi: 'viisi', vi: 'nƒÉm' },
                { fi: 'kuusi', vi: 's√°u' },
                { fi: 'seitsem√§n', vi: 'b·∫£y' },
                { fi: 'kahdeksan', vi: 't√°m' },
                { fi: 'yhdeks√§n', vi: 'ch√≠n' },
                { fi: 'kymmenen', vi: 'm∆∞·ªùi' }
            ],
            family: [
                { fi: 'perhe', vi: 'gia ƒë√¨nh' },
                { fi: '√§iti', vi: 'm·∫π' },
                { fi: 'is√§', vi: 'b·ªë' },
                { fi: 'veli', vi: 'anh/em trai' },
                { fi: 'sisko', vi: 'ch·ªã/em g√°i' },
                { fi: 'lapsi', vi: 'con' },
                { fi: 'poika', vi: 'con trai' },
                { fi: 'tytt√∂', vi: 'con g√°i' },
                { fi: 'mummo', vi: 'b√†' },
                { fi: 'pappa', vi: '√¥ng' }
            ],
            food: [
                { fi: 'ruoka', vi: 'ƒë·ªì ƒÉn' },
                { fi: 'leip√§', vi: 'b√°nh m√¨' },
                { fi: 'vesi', vi: 'n∆∞·ªõc' },
                { fi: 'kahvi', vi: 'c√† ph√™' },
                { fi: 'maito', vi: 's·ªØa' },
                { fi: 'liha', vi: 'th·ªãt' },
                { fi: 'kala', vi: 'c√°' },
                { fi: 'peruna', vi: 'khoai t√¢y' },
                { fi: 'omena', vi: 't√°o' },
                { fi: 'juusto', vi: 'ph√¥ mai' }
            ],
            phrases: [
                { fi: 'Minun nimeni on...', vi: 'T√™n t√¥i l√†...' },
                { fi: 'Olen vietnamilainen', vi: 'T√¥i l√† ng∆∞·ªùi Vi·ªát Nam' },
                { fi: 'Puhutko englantia?', vi: 'B·∫°n n√≥i ti·∫øng Anh kh√¥ng?' },
                { fi: 'En ymm√§rr√§', vi: 'T√¥i kh√¥ng hi·ªÉu' },
                { fi: 'Voitko toistaa?', vi: 'B·∫°n c√≥ th·ªÉ nh·∫Øc l·∫°i kh√¥ng?' },
                { fi: 'Miss√§ on...?', vi: '·ªû ƒë√¢u c√≥...?' },
                { fi: 'Paljonko t√§m√§ maksaa?', vi: 'C√°i n√†y gi√° bao nhi√™u?' },
                { fi: 'Haluaisin...', vi: 'T√¥i mu·ªën...' },
                { fi: 'Tarvitsen apua', vi: 'T√¥i c·∫ßn gi√∫p ƒë·ª°' },
                { fi: 'Hyv√§√§ matkaa!', vi: 'Th∆∞·ª£ng l·ªô b√¨nh an!' }
            ]
        };

        let recWords = [];
        let recIndex = 0;
        let mediaRecorder = null;
        let audioChunks = [];
        let recordedBlob = null;
        let isRecording = false;
        let recordingTimer = null;
        let recordingSeconds = 0;
        let audioContext = null;
        let analyser = null;
        let animationId = null;

        function initRecording() {
            const topic = document.getElementById('recording-topic').value;
            recWords = [...recordingData[topic]];
            recIndex = 0;
            recordedBlob = null;
            updateRecordingDisplay();
            resetRecordingUI();
        }

        function updateRecordingDisplay() {
            if (recIndex >= recWords.length) {
                recIndex = 0;
            }
            if (recIndex < 0) {
                recIndex = recWords.length - 1;
            }

            const word = recWords[recIndex];
            document.getElementById('rec-finnish').textContent = word.fi;
            document.getElementById('rec-vietnamese').textContent = word.vi;
            document.getElementById('rec-current').textContent = recIndex + 1;
            document.getElementById('rec-total').textContent = recWords.length;

            // Reset for new word
            resetRecordingUI();
        }

        function resetRecordingUI() {
            recordedBlob = null;
            document.getElementById('playback-btn').disabled = true;
            document.getElementById('recording-comparison').classList.add('hidden');
            document.getElementById('record-icon').textContent = 'üéôÔ∏è';
            document.getElementById('record-text').textContent = 'Ghi √¢m';
            document.getElementById('record-btn').classList.remove('recording');
            document.getElementById('recording-timer').classList.add('hidden');
            document.getElementById('waveform-canvas').classList.add('hidden');
            document.querySelector('.waveform-placeholder').classList.remove('hidden');
            stopWaveformAnimation();
        }

        function playSample() {
            const word = recWords[recIndex];
            speak(word.fi);
        }

        async function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = (e) => {
                    audioChunks.push(e.data);
                };

                mediaRecorder.onstop = () => {
                    recordedBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    document.getElementById('playback-btn').disabled = false;
                    document.getElementById('recording-comparison').classList.remove('hidden');

                    // Stop all tracks
                    stream.getTracks().forEach(track => track.stop());
                };

                mediaRecorder.start();
                isRecording = true;

                // Update UI
                document.getElementById('record-icon').textContent = '‚èπÔ∏è';
                document.getElementById('record-text').textContent = 'D·ª´ng';
                document.getElementById('record-btn').classList.add('recording');
                document.getElementById('recording-timer').classList.remove('hidden');

                // Start timer
                recordingSeconds = 0;
                updateTimerDisplay();
                recordingTimer = setInterval(() => {
                    recordingSeconds++;
                    updateTimerDisplay();

                    // Auto stop after 10 seconds
                    if (recordingSeconds >= 10) {
                        stopRecording();
                    }
                }, 1000);

                // Start waveform visualization
                startWaveformAnimation(stream);

            } catch (err) {
                console.error('Error accessing microphone:', err);
                alert('Kh√¥ng th·ªÉ truy c·∫≠p microphone. Vui l√≤ng cho ph√©p quy·ªÅn truy c·∫≠p microphone trong tr√¨nh duy·ªát.');
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;

                // Update UI
                document.getElementById('record-icon').textContent = 'üéôÔ∏è';
                document.getElementById('record-text').textContent = 'Ghi l·∫°i';
                document.getElementById('record-btn').classList.remove('recording');

                // Stop timer
                clearInterval(recordingTimer);

                // Stop waveform
                stopWaveformAnimation();
            }
        }

        function updateTimerDisplay() {
            const mins = Math.floor(recordingSeconds / 60);
            const secs = recordingSeconds % 60;
            document.getElementById('timer-text').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function playRecording() {
            if (recordedBlob) {
                const audio = new Audio(URL.createObjectURL(recordedBlob));
                audio.play();
            }
        }

        function startWaveformAnimation(stream) {
            const canvas = document.getElementById('waveform-canvas');
            const ctx = canvas.getContext('2d');

            canvas.classList.remove('hidden');
            document.querySelector('.waveform-placeholder').classList.add('hidden');

            // Set canvas size
            canvas.width = canvas.offsetWidth * 2;
            canvas.height = canvas.offsetHeight * 2;
            ctx.scale(2, 2);

            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            const source = audioContext.createMediaStreamSource(stream);
            source.connect(analyser);

            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            function draw() {
                animationId = requestAnimationFrame(draw);

                analyser.getByteFrequencyData(dataArray);

                const width = canvas.offsetWidth;
                const height = canvas.offsetHeight;

                ctx.fillStyle = 'rgba(248, 250, 252, 0.1)';
                ctx.fillRect(0, 0, width, height);

                const barWidth = (width / bufferLength) * 2.5;
                let x = 0;

                for (let i = 0; i < bufferLength; i++) {
                    const barHeight = (dataArray[i] / 255) * height * 0.8;

                    // Gradient from primary to accent
                    const hue = 210 + (i / bufferLength) * 30;
                    ctx.fillStyle = `hsl(${hue}, 70%, 50%)`;

                    ctx.fillRect(x, height - barHeight, barWidth - 1, barHeight);
                    x += barWidth;
                }
            }

            draw();
        }

        function stopWaveformAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
        }

        function prevRecordingWord() {
            recIndex--;
            updateRecordingDisplay();
        }

        function nextRecordingWord() {
            recIndex++;
            updateRecordingDisplay();
        }

        // Event listener for topic change
        document.getElementById('recording-topic').addEventListener('change', initRecording);

        // Daily Challenge
        function startChallenge() {
            document.querySelectorAll('.mode-btn')[0].click();
            document.getElementById('flashcard-topic').value = 'family';
            initFlashcards();
        }

        // Update challenge date
        const today = new Date();
        document.getElementById('challenge-date').textContent = today.toLocaleDateString('vi-VN');

        // Helper functions
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Initialize
        initFlashcards();
    </script>
</body>
</html>
