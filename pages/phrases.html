<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M·∫´u c√¢u giao ti·∫øp - H·ªçc Ti·∫øng Ph·∫ßn Lan A1</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Tabs */
        .tabs-container {
            display: flex;
            gap: 0;
            margin: 1rem;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 0.25rem;
            border: 1px solid var(--border);
        }
        .tab-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--radius);
            transition: var(--transition);
            color: var(--text-light);
        }
        .tab-btn:hover {
            background: var(--bg-alt);
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
        }
        .tab-btn .tab-count {
            display: block;
            font-size: 0.7rem;
            font-weight: 400;
            opacity: 0.8;
            margin-top: 0.2rem;
        }

        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* Essential Hero */
        .essential-hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.25rem;
            border-radius: var(--radius-lg);
            margin: 0 1rem 1rem;
            text-align: center;
        }
        .essential-hero h2 { font-size: 1.3rem; margin-bottom: 0.25rem; }
        .essential-hero p { font-size: 0.85rem; opacity: 0.9; }
        .essential-progress {
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            height: 8px;
            margin-top: 0.75rem;
            overflow: hidden;
        }
        .essential-progress-fill {
            background: var(--accent);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }
        .essential-stats {
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }

        /* Phrase Groups */
        .phrase-group {
            margin: 0 1rem 1rem;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
        }
        .group-header {
            background: var(--bg-alt);
            padding: 0.6rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
        }
        .group-header h3 {
            font-size: 0.95rem;
            color: var(--primary);
        }
        .group-header .count {
            font-size: 0.7rem;
            background: var(--primary);
            color: white;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
        }
        .group-content { padding: 0.5rem; }

        /* Phrase Item */
        .phrase-item {
            display: flex;
            align-items: flex-start;
            padding: 0.6rem 0.75rem;
            border-radius: var(--radius);
            margin-bottom: 0.4rem;
            background: var(--bg);
            border: 1px solid transparent;
            transition: var(--transition);
            position: relative;
        }
        .phrase-item:hover {
            border-color: var(--primary);
            background: var(--bg-card);
        }
        .phrase-item.essential { border-left: 3px solid var(--accent); }
        .phrase-item.emergency {
            border-left: 3px solid var(--danger);
            background: rgba(239,68,68,0.03);
        }
        .phrase-item.has-answer {
            flex-direction: column;
            gap: 0.5rem;
        }

        .phrase-num {
            width: 22px;
            height: 22px;
            background: var(--accent);
            color: var(--primary-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.7rem;
            margin-right: 0.6rem;
            flex-shrink: 0;
        }
        .phrase-item.emergency .phrase-num {
            background: var(--danger);
            color: white;
        }

        .phrase-main {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .phrase-text { flex: 1; min-width: 0; }
        .phrase-fi {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.95rem;
        }
        .phrase-vi {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Answer section */
        .phrase-answer {
            width: 100%;
            padding: 0.5rem 0.75rem;
            background: rgba(16, 185, 129, 0.08);
            border-radius: var(--radius);
            border-left: 3px solid var(--success);
            margin-left: 28px;
        }
        .answer-label {
            font-size: 0.7rem;
            color: var(--success);
            font-weight: 600;
            margin-bottom: 0.2rem;
        }
        .answer-fi {
            font-weight: 600;
            color: var(--success);
            font-size: 0.9rem;
        }
        .answer-vi {
            font-size: 0.75rem;
            color: var(--text-light);
        }
        .answer-audio {
            display: flex;
            gap: 0.25rem;
            margin-top: 0.3rem;
        }

        /* Audio buttons */
        .phrase-audio {
            display: flex;
            gap: 0.25rem;
            margin-left: 0.5rem;
            flex-shrink: 0;
        }
        .audio-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: var(--bg-card);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            transition: var(--transition);
        }
        .audio-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: scale(1.1);
        }
        .audio-btn.slow { font-size: 0.6rem; }
        .audio-btn.record.recording {
            background: var(--danger);
            border-color: var(--danger);
            animation: pulse 1s infinite;
        }
        .audio-btn.has-rec {
            border-color: var(--success);
            color: var(--success);
        }
        .audio-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Mastery */
        .phrase-mastery {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 16px;
            height: 16px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 50%;
            font-size: 0.55rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
        }
        .phrase-mastery.done {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        /* Compare Modal */
        .compare-modal {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            padding: 1rem;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            z-index: 1001;
        }
        .compare-modal.active { display: block; }
        .compare-modal h4 {
            text-align: center;
            margin-bottom: 0.75rem;
            color: var(--primary);
            font-size: 0.95rem;
        }
        .compare-btns {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }
        .compare-btns button {
            flex: 1;
            max-width: 120px;
            padding: 0.5rem;
            border-radius: var(--radius);
            border: 2px solid var(--border);
            background: var(--bg);
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
        }
        .compare-btns button:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .compare-close {
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--text-muted);
        }

        /* Category Filter */
        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            margin: 0 1rem 1rem;
            border-radius: var(--radius);
        }
        .filter-btn {
            padding: 0.35rem 0.7rem;
            border: 1px solid var(--border);
            border-radius: 15px;
            background: var(--bg);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }
        .filter-btn:hover, .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Mobile Header -->
    <header class="mobile-header">
        <a href="../index.html" class="logo">üá´üáÆ Suomi A1</a>
        <button class="menu-toggle" id="menuToggle">
            <span></span><span></span><span></span>
        </button>
    </header>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="logo">üá´üáÆ Suomi A1</a>
            <button class="dark-toggle" id="darkToggle">üåô</button>
        </div>
        <ul class="nav-menu">
            <li><a href="../index.html" class="nav-link"><span class="icon">üè†</span> Trang ch·ªß</a></li>
            <li><a href="alphabet.html" class="nav-link"><span class="icon">üî§</span> B·∫£ng ch·ªØ c√°i</a></li>
            <li><a href="pronunciation.html" class="nav-link"><span class="icon">üéØ</span> Ph√°t √¢m</a></li>
            <li><a href="grammar.html" class="nav-link"><span class="icon">üìñ</span> Ng·ªØ ph√°p</a></li>
            <li><a href="verbs.html" class="nav-link"><span class="icon">‚ö°</span> Chia ƒë·ªông t·ª´</a></li>
            <li><a href="vocabulary.html" class="nav-link"><span class="icon">üìö</span> T·ª´ v·ª±ng</a></li>
            <li><a href="phrases.html" class="nav-link active"><span class="icon">üí¨</span> M·∫´u c√¢u</a></li>
            <li><a href="practice.html" class="nav-link"><span class="icon">‚úèÔ∏è</span> Luy·ªán t·∫≠p</a></li>
            <li><a href="roadmap.html" class="nav-link"><span class="icon">üó∫Ô∏è</span> L·ªô tr√¨nh 30 ng√†y</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <section class="page-header" style="padding-bottom: 0.5rem;">
            <h1>üí¨ M·∫´u c√¢u giao ti·∫øp</h1>
        </section>

        <!-- TABS -->
        <div class="tabs-container">
            <button class="tab-btn active" data-tab="essential">
                ‚≠ê 20 C√¢u Ph·∫£i Nh·ªõ
                <span class="tab-count">H·ªçc tr∆∞·ªõc!</span>
            </button>
            <button class="tab-btn" data-tab="common">
                üí¨ 100+ M·∫´u C√¢u
                <span class="tab-count">Theo t√¨nh hu·ªëng</span>
            </button>
        </div>

        <!-- ========== TAB 1: 20 C√ÇU PH·∫¢I NH·ªö ========== -->
        <div class="tab-content active" id="tab-essential">
            <div class="essential-hero">
                <h2>‚≠ê 20 C√¢u PH·∫¢I NH·ªö</h2>
                <p>Thu·ªôc l√≤ng tr∆∞·ªõc khi h·ªçc g√¨ kh√°c!</p>
                <div class="essential-progress">
                    <div class="essential-progress-fill" id="progressFill"></div>
                </div>
                <div class="essential-stats">
                    ‚úÖ ƒê√£ luy·ªán: <strong id="practicedCount">0</strong>/20
                </div>
            </div>

            <!-- Groups s·∫Ω ƒë∆∞·ª£c render b·ªüi JS -->
            <div id="essentialGroups"></div>
        </div>

        <!-- ========== TAB 2: 100+ C√ÇU PH·ªî BI·∫æN ========== -->
        <div class="tab-content" id="tab-common">
            <!-- Filter -->
            <div class="category-filter">
                <button class="filter-btn active" data-cat="all">T·∫•t c·∫£</button>
                <button class="filter-btn" data-cat="greetings">üëã Ch√†o h·ªèi</button>
                <button class="filter-btn" data-cat="intro">üë§ Gi·ªõi thi·ªáu</button>
                <button class="filter-btn" data-cat="questions">‚ùì H·ªèi & ƒê√°p</button>
                <button class="filter-btn" data-cat="daily">üè† H√†ng ng√†y</button>
                <button class="filter-btn" data-cat="shopping">üõí Mua s·∫Øm</button>
                <button class="filter-btn" data-cat="restaurant">üçΩÔ∏è Nh√† h√†ng</button>
                <button class="filter-btn" data-cat="transport">üöå Di chuy·ªÉn</button>
                <button class="filter-btn" data-cat="emergency">üö® Kh·∫©n c·∫•p</button>
            </div>

            <!-- Groups s·∫Ω ƒë∆∞·ª£c render b·ªüi JS -->
            <div id="commonGroups"></div>
        </div>

        <!-- Emergency Box -->
        <div class="emergency-box" style="margin: 1rem;">
            <h3>üìû S·ªë kh·∫©n c·∫•p Ph·∫ßn Lan</h3>
            <div class="emergency-number">
                <span class="number">112</span>
                <span class="desc">C·∫£nh s√°t, C·ª©u h·ªèa, C·∫•p c·ª©u</span>
            </div>
        </div>

        <!-- Nav -->
        <div class="page-nav">
            <a href="vocabulary.html" class="nav-btn prev">‚Üê T·ª´ v·ª±ng</a>
            <a href="practice.html" class="nav-btn next">Luy·ªán t·∫≠p ‚Üí</a>
        </div>
    </main>

    <!-- Compare Modal -->
    <div class="compare-modal" id="compareModal">
        <button class="compare-close" onclick="closeCompare()">√ó</button>
        <h4>üéß So s√°nh ph√°t √¢m</h4>
        <div class="compare-btns">
            <button onclick="playStandard()">üîä Chu·∫©n</button>
            <button onclick="playYours()">üé§ C·ªßa b·∫°n</button>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>

    <script src="../js/data.js"></script>
    <script src="../js/app.js"></script>
    <script>
        // ==================== DATA ====================
        const essentialPhrases = [
            // Group 1: Ch√†o h·ªèi (1-7)
            { fi: "Hei!", vi: "Xin ch√†o!", group: 1, groupName: "üëã Ch√†o h·ªèi c∆° b·∫£n" },
            { fi: "Moi!", vi: "Ch√†o! (th√¢n m·∫≠t)", group: 1 },
            { fi: "Kiitos!", vi: "C·∫£m ∆°n!", group: 1 },
            { fi: "Anteeksi!", vi: "Xin l·ªói! / Cho h·ªèi!", group: 1 },
            { fi: "Kyll√§ / Joo", vi: "V√¢ng / C√≥", group: 1 },
            { fi: "Ei", vi: "Kh√¥ng", group: 1 },
            { fi: "Moi moi! / Hei hei!", vi: "T·∫°m bi·ªát!", group: 1 },
            // Group 2: Gi·ªõi thi·ªáu (8-10)
            { fi: "Minun nimeni on...", vi: "T√™n t√¥i l√†...", group: 2, groupName: "üë§ Gi·ªõi thi·ªáu b·∫£n th√¢n" },
            { fi: "Olen vietnamilainen.", vi: "T√¥i l√† ng∆∞·ªùi Vi·ªát Nam.", group: 2 },
            { fi: "Puhun v√§h√§n suomea.", vi: "T√¥i n√≥i ch√∫t ti·∫øng Ph·∫ßn Lan.", group: 2 },
            // Group 3: Xin gi√∫p ƒë·ª° (11-14)
            { fi: "En ymm√§rr√§.", vi: "T√¥i kh√¥ng hi·ªÉu.", group: 3, groupName: "üÜò Khi c·∫ßn gi√∫p ƒë·ª°" },
            { fi: "Puhutko englantia?", vi: "B·∫°n n√≥i ti·∫øng Anh kh√¥ng?", group: 3 },
            { fi: "Voitko toistaa?", vi: "Nh·∫Øc l·∫°i ƒë∆∞·ª£c kh√¥ng?", group: 3 },
            { fi: "Puhu hitaammin, ole hyv√§.", vi: "Xin n√≥i ch·∫≠m h∆°n.", group: 3 },
            // Group 4: Sinh ho·∫°t (15-18)
            { fi: "Paljonko t√§m√§ maksaa?", vi: "C√°i n√†y gi√° bao nhi√™u?", group: 4, groupName: "üõí Sinh ho·∫°t h√†ng ng√†y" },
            { fi: "Yksi kahvi, kiitos.", vi: "M·ªôt c√† ph√™, c·∫£m ∆°n.", group: 4 },
            { fi: "Miss√§ on...?", vi: "...·ªü ƒë√¢u?", group: 4 },
            { fi: "Miss√§ on WC?", vi: "Nh√† v·ªá sinh ·ªü ƒë√¢u?", group: 4 },
            // Group 5: Kh·∫©n c·∫•p (19-20)
            { fi: "Apua!", vi: "C·ª©u!", group: 5, groupName: "üö® Kh·∫©n c·∫•p", emergency: true },
            { fi: "Tarvitsen apua.", vi: "T√¥i c·∫ßn gi√∫p ƒë·ª°.", group: 5, emergency: true }
        ];

        const commonPhrases = {
            greetings: {
                name: "üëã Ch√†o h·ªèi & T·∫°m bi·ªát",
                phrases: [
                    { fi: "Hyv√§√§ huomenta!", vi: "Ch√†o bu·ªïi s√°ng!" },
                    { fi: "Hyv√§√§ p√§iv√§√§!", vi: "Ch√†o bu·ªïi chi·ªÅu!" },
                    { fi: "Hyv√§√§ iltaa!", vi: "Ch√†o bu·ªïi t·ªëi!" },
                    { fi: "Hyv√§√§ y√∂t√§!", vi: "Ch√∫c ng·ªß ngon!" },
                    { fi: "Terve!", vi: "Ch√†o! (th√¥ng d·ª•ng)" },
                    { fi: "Moikka!", vi: "Ch√†o! (r·∫•t th√¢n m·∫≠t)" },
                    { fi: "N√§kemiin!", vi: "T·∫°m bi·ªát! (trang tr·ªçng)" },
                    { fi: "Heippa!", vi: "Bye! (th√¢n m·∫≠t)" },
                    { fi: "N√§hd√§√§n!", vi: "H·∫πn g·∫∑p l·∫°i!" },
                    { fi: "N√§hd√§√§n huomenna!", vi: "H·∫πn g·∫∑p ng√†y mai!" },
                    { fi: "Hyv√§√§ viikonloppua!", vi: "Cu·ªëi tu·∫ßn vui v·∫ª!" },
                    { fi: "Hauska tavata!", vi: "R·∫•t vui ƒë∆∞·ª£c g·∫∑p!" }
                ]
            },
            intro: {
                name: "üë§ Gi·ªõi thi·ªáu b·∫£n th√¢n",
                phrases: [
                    { fi: "Olen kotoisin Vietnamista.", vi: "T√¥i ƒë·∫øn t·ª´ Vi·ªát Nam." },
                    { fi: "Asun Helsingiss√§.", vi: "T√¥i s·ªëng ·ªü Helsinki." },
                    { fi: "Olen opiskelija.", vi: "T√¥i l√† sinh vi√™n." },
                    { fi: "Olen t√∂iss√§.", vi: "T√¥i ƒëi l√†m." },
                    { fi: "Puhun vietnamia.", vi: "T√¥i n√≥i ti·∫øng Vi·ªát." },
                    { fi: "Opiskelen suomea.", vi: "T√¥i ƒëang h·ªçc ti·∫øng Ph·∫ßn Lan." },
                    { fi: "Pid√§n Suomesta.", vi: "T√¥i th√≠ch Ph·∫ßn Lan." },
                    { fi: "Suomi on kaunis maa.", vi: "Ph·∫ßn Lan l√† ƒë·∫•t n∆∞·ªõc ƒë·∫πp." }
                ]
            },
            questions: {
                name: "‚ùì C√¢u h·ªèi & Tr·∫£ l·ªùi",
                phrases: [
                    {
                        fi: "Mit√§ kuuluu?", vi: "B·∫°n kh·ªèe kh√¥ng?",
                        answer: { fi: "Kiitos, hyv√§√§! Ent√§ sinulle?", vi: "C·∫£m ∆°n, t·ªët! C√≤n b·∫°n?" }
                    },
                    {
                        fi: "Mik√§ sinun nimesi on?", vi: "T√™n b·∫°n l√† g√¨?",
                        answer: { fi: "Minun nimeni on [t√™n].", vi: "T√™n t√¥i l√† [t√™n]." }
                    },
                    {
                        fi: "Mist√§ olet kotoisin?", vi: "B·∫°n ƒë·∫øn t·ª´ ƒë√¢u?",
                        answer: { fi: "Olen kotoisin Vietnamista.", vi: "T√¥i ƒë·∫øn t·ª´ Vi·ªát Nam." }
                    },
                    {
                        fi: "Miss√§ asut?", vi: "B·∫°n s·ªëng ·ªü ƒë√¢u?",
                        answer: { fi: "Asun Helsingiss√§.", vi: "T√¥i s·ªëng ·ªü Helsinki." }
                    },
                    {
                        fi: "Kuinka vanha olet?", vi: "B·∫°n bao nhi√™u tu·ªïi?",
                        answer: { fi: "Olen 25 vuotta vanha.", vi: "T√¥i 25 tu·ªïi." }
                    },
                    {
                        fi: "Mit√§ teet ty√∂ksesi?", vi: "B·∫°n l√†m ngh·ªÅ g√¨?",
                        answer: { fi: "Olen insin√∂√∂ri / opiskelija.", vi: "T√¥i l√† k·ªπ s∆∞ / sinh vi√™n." }
                    },
                    {
                        fi: "Puhutko suomea?", vi: "B·∫°n n√≥i ti·∫øng Ph·∫ßn Lan kh√¥ng?",
                        answer: { fi: "Puhun v√§h√§n suomea.", vi: "T√¥i n√≥i m·ªôt ch√∫t." }
                    },
                    {
                        fi: "Mit√§ kello on?", vi: "M·∫•y gi·ªù r·ªìi?",
                        answer: { fi: "Kello on kolme.", vi: "B√¢y gi·ªù l√† 3 gi·ªù." }
                    },
                    {
                        fi: "Onko sinulla aikaa?", vi: "B·∫°n c√≥ th·ªùi gian kh√¥ng?",
                        answer: { fi: "Kyll√§, minulla on aikaa.", vi: "C√≥, t√¥i c√≥ th·ªùi gian." }
                    },
                    {
                        fi: "Voitko auttaa minua?", vi: "B·∫°n gi√∫p t√¥i ƒë∆∞·ª£c kh√¥ng?",
                        answer: { fi: "Tietenkin! / Valitettavasti en voi.", vi: "T·∫•t nhi√™n! / Ti·∫øc l√† kh√¥ng ƒë∆∞·ª£c." }
                    },
                    {
                        fi: "Paljonko t√§m√§ maksaa?",  vi: "C√°i n√†y gi√° bao nhi√™u?",
                        answer: { fi: "Se maksaa viisi euroa.", vi: "N√≥ gi√° 5 euro." }
                    },
                    {
                        fi: "Miss√§ on WC?", vi: "Nh√† v·ªá sinh ·ªü ƒë√¢u?",
                        answer: { fi: "Se on tuolla / oikealla.", vi: "N√≥ ·ªü kia / b√™n ph·∫£i." }
                    }
                ]
            },
            daily: {
                name: "üè† Giao ti·∫øp h√†ng ng√†y",
                phrases: [
                    { fi: "Hyv√§√§ ruokahalua!", vi: "ƒÇn ngon mi·ªáng nh√©!" },
                    { fi: "Kippis!", vi: "Ch√∫c m·ª´ng! (n√¢ng ly)" },
                    { fi: "Anteeksi, olen my√∂h√§ss√§.", vi: "Xin l·ªói, t√¥i tr·ªÖ." },
                    { fi: "Ei se mit√§√§n.", vi: "Kh√¥ng sao ƒë√¢u." },
                    { fi: "Ole hyv√§.", vi: "M·ªùi b·∫°n. / Kh√¥ng c√≥ g√¨." },
                    { fi: "Saisinko...?", vi: "T√¥i c√≥ th·ªÉ xin...?" },
                    { fi: "Tietenkin!", vi: "T·∫•t nhi√™n!" },
                    { fi: "Hetkinen.", vi: "Ch·ªù m·ªôt ch√∫t." },
                    { fi: "Olen v√§synyt.", vi: "T√¥i m·ªát." },
                    { fi: "Minulla on n√§lk√§.", vi: "T√¥i ƒë√≥i." },
                    { fi: "Minulla on jano.", vi: "T√¥i kh√°t." },
                    { fi: "Selv√§! / OK!", vi: "ƒê∆∞·ª£c! / OK!" },
                    { fi: "En tied√§.", vi: "T√¥i kh√¥ng bi·∫øt." },
                    { fi: "Ehk√§.", vi: "C√≥ th·ªÉ." },
                    { fi: "Onneksi olkoon!", vi: "Ch√∫c m·ª´ng!" }
                ]
            },
            shopping: {
                name: "üõí Mua s·∫Øm",
                phrases: [
                    { fi: "Haluaisin ostaa...", vi: "T√¥i mu·ªën mua..." },
                    { fi: "Kuinka paljon?", vi: "Bao nhi√™u ti·ªÅn?" },
                    { fi: "Se on liian kallis.", vi: "ƒê·∫Øt qu√°." },
                    { fi: "Onko teill√§ alennusta?", vi: "C√≥ gi·∫£m gi√° kh√¥ng?" },
                    { fi: "Otan t√§m√§n.", vi: "T√¥i l·∫•y c√°i n√†y." },
                    { fi: "Voinko maksaa kortilla?", vi: "Tr·∫£ b·∫±ng th·∫ª ƒë∆∞·ª£c kh√¥ng?" },
                    { fi: "K√§teisell√§, kiitos.", vi: "Ti·ªÅn m·∫∑t, c·∫£m ∆°n." },
                    { fi: "Kuitti, kiitos.", vi: "Cho t√¥i h√≥a ƒë∆°n." },
                    { fi: "Miss√§ on kassa?", vi: "Qu·∫ßy thanh to√°n ·ªü ƒë√¢u?" },
                    { fi: "Tarvitsen pussin.", vi: "T√¥i c·∫ßn t√∫i." },
                    { fi: "Onko t√§m√§ tarjouksessa?", vi: "C√≥ khuy·∫øn m√£i kh√¥ng?" },
                    { fi: "Haluaisin palauttaa t√§m√§n.", vi: "T√¥i mu·ªën tr·∫£ l·∫°i c√°i n√†y." }
                ]
            },
            restaurant: {
                name: "üçΩÔ∏è Nh√† h√†ng & Caf√©",
                phrases: [
                    { fi: "P√∂yt√§ kahdelle, kiitos.", vi: "B√†n cho 2 ng∆∞·ªùi." },
                    { fi: "Ruokalista, kiitos.", vi: "Cho xin menu." },
                    { fi: "Mit√§ suosittelette?", vi: "B·∫°n g·ª£i √Ω g√¨?" },
                    { fi: "Olen allerginen...", vi: "T√¥i b·ªã d·ªã ·ª©ng v·ªõi..." },
                    { fi: "Olen kasvissy√∂j√§.", vi: "T√¥i ƒÉn chay." },
                    { fi: "Tilaan...", vi: "T√¥i g·ªçi..." },
                    { fi: "Yksi kahvi, kiitos.", vi: "M·ªôt c√† ph√™, c·∫£m ∆°n." },
                    { fi: "Yksi olut, kiitos.", vi: "M·ªôt bia, c·∫£m ∆°n." },
                    { fi: "Vett√§, kiitos.", vi: "N∆∞·ªõc l·ªçc, c·∫£m ∆°n." },
                    { fi: "Lasku, kiitos.", vi: "T√≠nh ti·ªÅn, c·∫£m ∆°n." },
                    { fi: "Pid√§ vaihtorahat.", vi: "Gi·ªØ l·∫°i ti·ªÅn th·ª´a (tip)." },
                    { fi: "Se oli herkullista!", vi: "Ngon qu√°!" },
                    { fi: "Saisinko lis√§√§...?", vi: "Cho th√™m... ƒë∆∞·ª£c kh√¥ng?" },
                    { fi: "Ei sipulia, kiitos.", vi: "Kh√¥ng h√†nh, c·∫£m ∆°n." },
                    { fi: "Onko teill√§ wifi?", vi: "C√≥ wifi kh√¥ng?" }
                ]
            },
            transport: {
                name: "üöå Di chuy·ªÉn & H·ªèi ƒë∆∞·ªùng",
                phrases: [
                    { fi: "Miss√§ on bussipys√§kki?", vi: "Tr·∫°m xe bu√Ωt ·ªü ƒë√¢u?" },
                    { fi: "Miss√§ on rautatieasema?", vi: "Ga t√†u ·ªü ƒë√¢u?" },
                    { fi: "Mik√§ bussi menee...?", vi: "Xe bu√Ωt n√†o ƒë·∫øn...?" },
                    { fi: "Yksi lippu, kiitos.", vi: "M·ªôt v√©, c·∫£m ∆°n." },
                    { fi: "Meno-paluu lippu.", vi: "V√© kh·ª© h·ªìi." },
                    { fi: "Kuinka kauan kest√§√§?", vi: "M·∫•t bao l√¢u?" },
                    { fi: "Milloin juna l√§htee?", vi: "T√†u kh·ªüi h√†nh l√∫c n√†o?" },
                    { fi: "Onko t√§m√§ oikea juna?", vi: "ƒê√¢y c√≥ ph·∫£i t√†u ƒë√∫ng kh√¥ng?" },
                    { fi: "Miss√§ minun pit√§√§ j√§√§d√§ pois?", vi: "T√¥i xu·ªëng ·ªü ƒë√¢u?" },
                    { fi: "K√§√§nny oikealle.", vi: "R·∫Ω ph·∫£i." },
                    { fi: "K√§√§nny vasemmalle.", vi: "R·∫Ω tr√°i." },
                    { fi: "Mene suoraan.", vi: "ƒêi th·∫≥ng." }
                ]
            },
            emergency: {
                name: "üö® Kh·∫©n c·∫•p",
                phrases: [
                    { fi: "Apua!", vi: "C·ª©u!", emergency: true },
                    { fi: "Tarvitsen apua.", vi: "T√¥i c·∫ßn gi√∫p ƒë·ª°.", emergency: true },
                    { fi: "Soita ambulanssi!", vi: "G·ªçi xe c·∫•p c·ª©u!", emergency: true },
                    { fi: "Soita poliisi!", vi: "G·ªçi c·∫£nh s√°t!", emergency: true },
                    { fi: "Tulipalo!", vi: "Ch√°y!", emergency: true },
                    { fi: "Olen sairas.", vi: "T√¥i b·ªã ·ªëm." },
                    { fi: "Minulle sattui tapaturma.", vi: "T√¥i b·ªã tai n·∫°n." },
                    { fi: "Tarvitsen l√§√§k√§rin.", vi: "T√¥i c·∫ßn b√°c sƒ©." },
                    { fi: "Miss√§ on sairaala?", vi: "B·ªánh vi·ªán ·ªü ƒë√¢u?" },
                    { fi: "Olen eksynyt.", vi: "T√¥i b·ªã l·∫°c." },
                    { fi: "Passi on varastettu.", vi: "H·ªô chi·∫øu b·ªã ƒë√°nh c·∫Øp." },
                    { fi: "Voitteko auttaa minua?", vi: "C√°c b·∫°n gi√∫p t√¥i ƒë∆∞·ª£c kh√¥ng?" }
                ]
            }
        };

        // ==================== STATE ====================
        const recordings = new Map();
        const practiced = JSON.parse(localStorage.getItem('essentialPhrases') || '{}');
        let activeRecorder = null;
        let currentPhrase = '';
        let currentId = '';

        // ==================== RENDER FUNCTIONS ====================
        function createAudioBtns() {
            return `
                <div class="phrase-audio">
                    <button class="audio-btn listen" title="Nghe">üîä</button>
                    <button class="audio-btn slow" title="Ch·∫≠m">üê¢</button>
                    <button class="audio-btn record" title="Ghi">üéôÔ∏è</button>
                    <button class="audio-btn play" title="Ph√°t" disabled>‚ñ∂Ô∏è</button>
                </div>
            `;
        }

        function createPhraseItem(phrase, index, isEssential = false) {
            const id = isEssential ? `ess-${index}` : `com-${phrase.fi.substring(0,15).replace(/\s/g,'')}`;
            const isDone = practiced[id];
            const hasAnswer = phrase.answer;

            let html = `
                <div class="phrase-item ${isEssential ? 'essential' : ''} ${phrase.emergency ? 'emergency' : ''} ${hasAnswer ? 'has-answer' : ''}"
                     data-id="${id}" data-fi="${phrase.fi}">
                    <div class="phrase-main">
                        ${isEssential ? `<span class="phrase-num">${index + 1}</span>` : ''}
                        <div class="phrase-text">
                            <div class="phrase-fi">${phrase.fi}</div>
                            <div class="phrase-vi">${phrase.vi}</div>
                        </div>
                        ${createAudioBtns()}
                    </div>
            `;

            if (hasAnswer) {
                html += `
                    <div class="phrase-answer" data-fi="${phrase.answer.fi}">
                        <div class="answer-label">‚Ü≥ Tr·∫£ l·ªùi:</div>
                        <div class="answer-fi">${phrase.answer.fi}</div>
                        <div class="answer-vi">${phrase.answer.vi}</div>
                        <div class="answer-audio">
                            <button class="audio-btn listen answer-listen" title="Nghe">üîä</button>
                            <button class="audio-btn slow answer-slow" title="Ch·∫≠m">üê¢</button>
                        </div>
                    </div>
                `;
            }

            html += `<span class="phrase-mastery ${isDone ? 'done' : ''}">${isDone ? '‚úì' : '‚óã'}</span></div>`;
            return html;
        }

        // Render essential phrases
        function renderEssential() {
            const container = document.getElementById('essentialGroups');
            let html = '';
            const groups = {};

            essentialPhrases.forEach((p, i) => {
                if (!groups[p.group]) {
                    groups[p.group] = { name: p.groupName, phrases: [], startIdx: i };
                }
                groups[p.group].phrases.push({ ...p, idx: i });
            });

            Object.values(groups).forEach(group => {
                const isEmergency = group.phrases[0].emergency;
                html += `
                    <div class="phrase-group">
                        <div class="group-header" ${isEmergency ? 'style="background: rgba(239,68,68,0.1);"' : ''}>
                            <h3 ${isEmergency ? 'style="color: var(--danger);"' : ''}>${group.name}</h3>
                            <span class="count" ${isEmergency ? 'style="background: var(--danger);"' : ''}>${group.phrases.length} c√¢u</span>
                        </div>
                        <div class="group-content">
                            ${group.phrases.map(p => createPhraseItem(p, p.idx, true)).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Render common phrases
        function renderCommon() {
            const container = document.getElementById('commonGroups');
            let html = '';

            Object.entries(commonPhrases).forEach(([cat, data]) => {
                const isEmergency = cat === 'emergency';
                html += `
                    <div class="phrase-group phrase-category" data-cat="${cat}">
                        <div class="group-header" ${isEmergency ? 'style="background: rgba(239,68,68,0.1);"' : ''}>
                            <h3 ${isEmergency ? 'style="color: var(--danger);"' : ''}>${data.name}</h3>
                            <span class="count" ${isEmergency ? 'style="background: var(--danger);"' : ''}>${data.phrases.length} c√¢u</span>
                        </div>
                        <div class="group-content">
                            ${data.phrases.map((p, i) => createPhraseItem(p, i, false)).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        renderEssential();
        renderCommon();

        // ==================== EVENT HANDLERS ====================
        function attachEvents() {
            document.querySelectorAll('.phrase-item').forEach(item => {
                const fi = item.dataset.fi;
                const id = item.dataset.id;

                // Main phrase buttons
                item.querySelector('.listen').onclick = (e) => { e.stopPropagation(); speak(fi); };
                item.querySelector('.slow').onclick = (e) => { e.stopPropagation(); speak(fi, 0.4); };

                item.querySelector('.record').onclick = async (e) => {
                    e.stopPropagation();
                    const btn = e.target;
                    if (btn.classList.contains('recording')) {
                        stopRecording(id, item);
                    } else {
                        await startRecording(id, fi, item);
                    }
                };

                item.querySelector('.play').onclick = (e) => {
                    e.stopPropagation();
                    const blob = recordings.get(id);
                    if (blob) {
                        currentPhrase = fi;
                        currentId = id;
                        new Audio(URL.createObjectURL(blob)).play();
                    }
                };

                // Answer buttons (if exists)
                const answerEl = item.querySelector('.phrase-answer');
                if (answerEl) {
                    const answerFi = answerEl.dataset.fi;
                    answerEl.querySelector('.answer-listen').onclick = (e) => { e.stopPropagation(); speak(answerFi); };
                    answerEl.querySelector('.answer-slow').onclick = (e) => { e.stopPropagation(); speak(answerFi, 0.4); };
                }

                // Click text to listen
                item.querySelector('.phrase-text').onclick = () => speak(fi);
            });
        }
        attachEvents();

        async function startRecording(id, fi, item) {
            if (activeRecorder) activeRecorder.stop();

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const recorder = new MediaRecorder(stream);
                const chunks = [];

                recorder.ondataavailable = (e) => chunks.push(e.data);
                recorder.onstop = async () => {
                    const blob = new Blob(chunks, { type: 'audio/webm' });
                    recordings.set(id, blob);
                    stream.getTracks().forEach(t => t.stop());

                    // Upload to Supabase
                    if (window.supabaseStorage) {
                        await window.supabaseStorage.uploadRecording(id, blob);
                    }
                };

                recorder.start();
                activeRecorder = recorder;
                currentPhrase = fi;
                currentId = id;

                const btn = item.querySelector('.record');
                btn.classList.add('recording');
                btn.textContent = '‚èπÔ∏è';

                setTimeout(() => {
                    if (activeRecorder === recorder && recorder.state === 'recording') {
                        stopRecording(id, item);
                    }
                }, 4000);

            } catch (err) {
                alert('Kh√¥ng th·ªÉ truy c·∫≠p microphone.');
            }
        }

        function stopRecording(id, item) {
            if (activeRecorder?.state === 'recording') activeRecorder.stop();

            const recordBtn = item.querySelector('.record');
            const playBtn = item.querySelector('.play');
            const mastery = item.querySelector('.phrase-mastery');

            recordBtn.classList.remove('recording');
            recordBtn.textContent = 'üéôÔ∏è';
            recordBtn.classList.add('has-rec');

            setTimeout(() => {
                playBtn.disabled = false;
                playBtn.classList.add('has-rec');

                practiced[id] = true;
                localStorage.setItem('essentialPhrases', JSON.stringify(practiced));
                mastery.classList.add('done');
                mastery.textContent = '‚úì';

                updateProgress();
                document.getElementById('compareModal').classList.add('active');
            }, 200);

            activeRecorder = null;
        }

        // Load saved recordings from Supabase on page load
        async function loadSavedRecordings() {
            if (!window.supabaseStorage) return;

            document.querySelectorAll('.phrase-item').forEach(async (item) => {
                const id = item.dataset.id;
                if (practiced[id]) {
                    const blob = await window.supabaseStorage.getRecording(id);
                    if (blob && blob.size > 0) {
                        recordings.set(id, blob);
                        const playBtn = item.querySelector('.play');
                        const recordBtn = item.querySelector('.record');
                        if (playBtn) {
                            playBtn.disabled = false;
                            playBtn.classList.add('has-rec');
                        }
                        if (recordBtn) {
                            recordBtn.classList.add('has-rec');
                        }
                    }
                }
            });
        }
        loadSavedRecordings();

        function updateProgress() {
            const essentialIds = Array.from({ length: 20 }, (_, i) => `ess-${i}`);
            const done = essentialIds.filter(id => practiced[id]).length;
            document.getElementById('progressFill').style.width = (done / 20 * 100) + '%';
            document.getElementById('practicedCount').textContent = done;
        }
        updateProgress();

        // Compare modal - expose to window for onclick
        window.playStandard = function() {
            speak(currentPhrase);
        };
        window.playYours = function() {
            const blob = recordings.get(currentId);
            if (blob) {
                const audio = new Audio(URL.createObjectURL(blob));
                audio.play();
            } else {
                alert('Ch∆∞a c√≥ b·∫£n ghi √¢m!');
            }
        };
        window.closeCompare = function() {
            document.getElementById('compareModal').classList.remove('active');
        };

        // Tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(`tab-${btn.dataset.tab}`).classList.add('active');
            };
        });

        // Category Filter
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const cat = btn.dataset.cat;
                document.querySelectorAll('.phrase-category').forEach(group => {
                    group.style.display = (cat === 'all' || group.dataset.cat === cat) ? 'block' : 'none';
                });
            };
        });
    </script>
</body>
</html>
